{
  "version": 3,
  "sources": ["../server/index.ts"],
  "sourcesContent": ["import path from 'path'\nimport { fileURLToPath } from 'url'\nimport express from 'express'\nimport chokidar from 'chokidar'\nimport address from 'address'\nimport closeWithGrace from 'close-with-grace'\nimport crypto from 'crypto'\nimport {\n\ttype RequestHandler,\n\tcreateRequestHandler\n} from '@remix-run/express'\nimport {\n\ttype ServerBuild,\n\tbroadcastDevReady,\n\tinstallGlobals,\n} from '@remix-run/node'\nimport chalk from 'chalk'\nimport sourceMapSupport from 'source-map-support'\n\n// @ts-ignore - this file may not exist if you haven't built yet, but it will\n// definitely exist by the time the dev or prod server actually runs.\nimport * as remixBuild from '../build/index.js'\n\nsourceMapSupport.install()\ninstallGlobals()\n\nconst MODE = process.env.NODE_ENV\n\nconst BUILD_PATH = '../build/index.js'\n\nconst build = remixBuild as unknown as ServerBuild\n\nlet devBuild = build\n\nconst app = express()\n\nconst getHost = (req: { get: (key: string) => string | undefined }) =>\n\treq.get('X-Forwarded-Host') ?? req.get('host') ?? ''\n\n// ensure HTTPS only (X-Forwarded-Proto comes from Fly)\napp.use((req, res, next) => {\n\tconst proto = req.get('X-Forwarded-Proto')\n\tconst host = getHost(req)\n\tif (proto === 'http') {\n\t\tres.set('X-Forwarded-Proto', 'https')\n\t\tres.redirect(`https://${host}${req.originalUrl}`)\n\t\treturn\n\t}\n\tnext()\n})\n\n// no ending slashes for SEO reasons\n// https://github.com/epicweb-dev/epic-stack/discussions/108\napp.use((req, res, next) => {\n\tif (req.path.endsWith('/') && req.path.length > 1) {\n\t\tconst query = req.url.slice(req.path.length)\n\t\tconst safepath = req.path.slice(0, -1).replace(/\\/+/g, '/')\n\t\tres.redirect(301, safepath + query)\n\t} else {\n\t\tnext()\n\t}\n})\n\n// http://expressjs.com/en/advanced/best-practice-security.html#at-a-minimum-disable-x-powered-by-header\napp.disable('x-powered-by')\n\n// Remix fingerprints its assets so we can cache forever.\napp.use(\n\t'/build',\n\texpress.static('public/build', { immutable: true, maxAge: '1y' }),\n)\n\n// Aggressively cache fonts for a year\napp.use(\n\t'/fonts',\n\texpress.static('public/fonts', { immutable: true, maxAge: '1y' }),\n)\n\n// Everything else (like favicon.ico) is cached for an hour. You may want to be\n// more aggressive with this caching.\napp.use(express.static('public', { maxAge: '1h' }))\n\napp.use((_, res, next) => {\n\tres.locals.cspNonce = crypto.randomBytes(16).toString('hex')\n\tnext()\n})\n\nfunction getRequestHandler(build: ServerBuild): RequestHandler {\n\tfunction getLoadContext(_: any, res: any) {\n\t\treturn { cspNonce: res.locals.cspNonce }\n\t}\n\treturn createRequestHandler({ build, mode: MODE, getLoadContext })\n}\n\napp.all(\n\t'*',\n\tMODE === 'development'\n\t\t? (...args) => getRequestHandler(devBuild)(...args)\n\t\t: getRequestHandler(build),\n)\n\nconst desiredPort = Number(process.env.PORT || 3000)\nconst portToUse = desiredPort\n\nconst server = app.listen(portToUse, () => {\n\tconst addy = server.address()\n\tconst portUsed =\n\t\tdesiredPort === portToUse\n\t\t\t? desiredPort\n\t\t\t: addy && typeof addy === 'object'\n\t\t\t? addy.port\n\t\t\t: 0\n\n\tif (portUsed !== desiredPort) {\n\t\tconsole.warn(\n\t\t\tchalk.yellow(\n\t\t\t\t`\u26A0\uFE0F  Port ${desiredPort} is not available, using ${portUsed} instead.`,\n\t\t\t),\n\t\t)\n\t}\n\tconsole.log(`\uD83D\uDE80  We have liftoff!`)\n\tconst localUrl = `http://localhost:${portUsed}`\n\tlet lanUrl: string | null = null\n\tconst localIp = address.ip()\n\t// Check if the address is a private ip\n\t// https://en.wikipedia.org/wiki/Private_network#Private_IPv4_address_spaces\n\t// https://github.com/facebook/create-react-app/blob/d960b9e38c062584ff6cfb1a70e1512509a966e7/packages/react-dev-utils/WebpackDevServerUtils.js#LL48C9-L54C10\n\tif (/^10[.]|^172[.](1[6-9]|2[0-9]|3[0-1])[.]|^192[.]168[.]/.test(localIp)) {\n\t\tlanUrl = `http://${localIp}:${portUsed}`\n\t}\n\n\tconsole.log(\n\t\t`\n${chalk.bold('Local:')}            ${chalk.cyan(localUrl)}\n${lanUrl ? `${chalk.bold('On Your Network:')}  ${chalk.cyan(lanUrl)}` : ''}\n${chalk.bold('Press Ctrl+C to stop')}\n\t\t`.trim(),\n\t)\n\n\tif (MODE === 'development') {\n\t\tbroadcastDevReady(build)\n\t}\n})\n\ncloseWithGrace(async () => {\n\tawait new Promise((resolve, reject) => {\n\t\tserver.close(e => (e ? reject(e) : resolve('ok')))\n\t})\n})\n\n// during dev, we'll keep the build module up to date with the changes\nif (MODE === 'development') {\n\tasync function reloadBuild() {\n\t\tdevBuild = await import(`${BUILD_PATH}?update=${Date.now()}`)\n\t\tbroadcastDevReady(devBuild)\n\t}\n\n\tconst dirname = path.dirname(fileURLToPath(import.meta.url))\n\tconst watchPath = path.join(dirname, BUILD_PATH).replace(/\\\\/g, '/')\n\tconst watcher = chokidar.watch(watchPath, { ignoreInitial: true })\n\twatcher.on('all', reloadBuild)\n}\n"],
  "mappings": "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",
  "names": ["build"]
}
